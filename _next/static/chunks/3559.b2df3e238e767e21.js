(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3559],{24333:function(e,t,s){"use strict";var a,n,r=s(4410);function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}t.Z=function(e){return r.createElement("svg",i({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),a||(a=r.createElement("defs",null,r.createElement("path",{id:"clear_svg__a",d:"M0 0h16v16H0z"}))),r.createElement("g",null,n||(n=r.createElement("mask",{id:"clear_svg__b",fill:"#fff"},r.createElement("use",{xlinkHref:"#clear_svg__a"}))),r.createElement("g",{mask:"url(#clear_svg__b)"},r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M1 9.67h8.67l1-9.67H0l1 9.67Z",transform:"translate(2.667 5)"}),r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 0v3.33",transform:"translate(6.667 8.334)"}),r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 0v3.33",transform:"translate(9.334 8.333)"}),r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"m0 4 5.44-4L8 4",transform:"translate(4 1)"}))))}},84193:function(e,t,s){"use strict";var a,n,r=s(4410);function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}t.Z=function(e){return r.createElement("svg",i({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),a||(a=r.createElement("defs",null,r.createElement("path",{id:"copy_svg__a",d:"M0 0h16v16H0z"}))),r.createElement("g",null,n||(n=r.createElement("mask",{id:"copy_svg__b",fill:"#fff"},r.createElement("use",{xlinkHref:"#copy_svg__a"}))),r.createElement("g",{mask:"url(#copy_svg__b)"},r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 2.48V.94C0 .42.42 0 .94 0h8.12c.52 0 .94.42.94.94v8.12c0 .52-.42.94-.94.94H7.51",transform:"translate(4.333 1.667)"}),r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M.94 0C.42 0 0 .42 0 .94v8.12c0 .52.42.94.94.94h8.12c.52 0 .94-.42.94-.94V.94C10 .42 9.58 0 9.06 0H.94Z",transform:"translate(1.667 4.333)"}))))}},72495:function(e,t,s){"use strict";var a,n,r=s(4410);function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}t.Z=function(e){return r.createElement("svg",i({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),a||(a=r.createElement("defs",null,r.createElement("path",{id:"download_svg__a",d:"M0 0h16v16H0z"}))),r.createElement("g",null,n||(n=r.createElement("mask",{id:"download_svg__b",fill:"#fff"},r.createElement("use",{xlinkHref:"#download_svg__a"}))),r.createElement("g",{mask:"url(#download_svg__b)"},r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M1 12h10c.55 0 1-.45 1-1V1c0-.55-.45-1-1-1H1C.45 0 0 .45 0 1v10c0 .55.45 1 1 1Z",transform:"translate(2 2)"}),r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 0h3.67l.66 1.33H9L9.67 0h3.66",transform:"translate(1.333 10.333)"}),r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 3.33V0",transform:"translate(14 8.667)"}),r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"m0 0 2 2 2-2",transform:"translate(6 7.333)"}),r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 5.33V0",transform:"translate(8 4)"}),r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 3.33V0",transform:"translate(2 8.667)"}))))}},13559:function(e,t,s){"use strict";s.r(t),s.d(t,{Chat:function(){return eR},DeleteFileButton:function(){return eL},DeleteImageButton:function(){return eA},PromptHints:function(){return eH},ScrollDownToast:function(){return eT},SessionConfigModel:function(){return eD}});var a,n,r,i,o,l,c,m,h,d,u,p,g,_,x,f=s(57437),v=s(27266),y=s(2265),j=s(4410);function w(){return(w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}var k=function(e){return j.createElement("svg",w({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),a||(a=j.createElement("defs",null,j.createElement("path",{id:"share_svg__a",d:"M0 0h16v16H0z"}))),j.createElement("g",null,n||(n=j.createElement("mask",{id:"share_svg__b",fill:"#fff"},j.createElement("use",{xlinkHref:"#share_svg__a"}))),j.createElement("g",{mask:"url(#share_svg__b)"},j.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M6.67 3.67C1.67 3.67 0 7.33 0 13c0 0 2-5 6.67-5v3.67l6-5.67-6-6v3.67Z",transform:"translate(2 1.333)"}))))};function b(){return(b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}var C=function(e){return j.createElement("svg",b({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),r||(r=j.createElement("defs",null,j.createElement("path",{id:"send-white_svg__a",d:"M0 0h16v16H0z"}))),j.createElement("g",null,i||(i=j.createElement("mask",{id:"send-white_svg__b",fill:"#fff"},j.createElement("use",{xlinkHref:"#send-white_svg__a"}))),j.createElement("g",{mask:"url(#send-white_svg__b)"},j.createElement("path",{style:{stroke:"#fff",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 4.71 6.67 6l1.67 6.67L12.67 0 0 4.71Z",transform:"translate(1.333 2)"}),j.createElement("path",{style:{stroke:"#fff",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 1.89 1.89 0",transform:"translate(8.003 6.117)"}))))};function E(){return(E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}var S=function(e){return j.createElement("svg",E({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),o||(o=j.createElement("defs",null,j.createElement("path",{id:"rename_svg__a",d:"M0 0h16v16H0z"}))),j.createElement("g",null,l||(l=j.createElement("mask",{id:"rename_svg__b",fill:"#fff"},j.createElement("use",{xlinkHref:"#rename_svg__a"}))),j.createElement("g",{mask:"url(#rename_svg__b)"},j.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M2.83 13.2 13.2 2.83 10.37 0 0 10.37v2.83h2.83Z",transform:"translate(1.775 1.3)"}),j.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"m0 0 2.83 2.83",transform:"translate(9.317 4.13)"}))))};function N(){return(N=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}var P=function(e){return j.createElement("svg",N({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),c||(c=j.createElement("defs",null,j.createElement("path",{id:"export_svg__a",d:"M0 0h16v16H0z"}))),j.createElement("g",null,m||(m=j.createElement("mask",{id:"export_svg__b",fill:"#fff"},j.createElement("use",{xlinkHref:"#export_svg__a"}))),j.createElement("g",{mask:"url(#export_svg__b)"},j.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M12.27 9.11a3.09 3.09 0 0 0 1.16-3.44c-.41-1.28-1.65-1.98-2.99-1.98h-.77A4.924 4.924 0 0 0 5.47.03C3.45-.2 1.5.84.56 2.64c-.94 1.81-.67 4 .67 5.53",transform:"translate(1.24 2.333)"}),j.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 6V0",transform:"translate(8 7.667)"}),j.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M4.24 0 2.12 2.12 0 0",transform:"translate(5.879 11.545)"}))))};function Z(){return(Z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}var O=function(e){return j.createElement("svg",Z({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),h||(h=j.createElement("defs",null,j.createElement("path",{id:"return_svg__a",d:"M0 0h16v16H0z"}))),j.createElement("g",null,d||(d=j.createElement("mask",{id:"return_svg__b",fill:"#fff"},j.createElement("use",{xlinkHref:"#return_svg__a"}))),j.createElement("g",{mask:"url(#return_svg__b)"},j.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M2.33 0 0 2l2.33 2.33",transform:"translate(2 2.667)"}),j.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 0h7.66c2.3 0 4.25 1.87 4.34 4.17.09 2.42-1.91 4.5-4.34 4.5H2",transform:"translate(2 4.667)"}))))},M=s(84193),T=s(24053),D=s(14845),K=s(68397),H=s(98829),I=s(24333),W=s(12402);function A(){return(A=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}var L=function(e){return j.createElement("svg",A({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),u||(u=j.createElement("defs",null,j.createElement("path",{id:"bottom_svg__a",d:"M0 0h16v16H0z"}))),j.createElement("g",null,p||(p=j.createElement("mask",{id:"bottom_svg__b",fill:"#fff"},j.createElement("use",{xlinkHref:"#bottom_svg__a"}))),j.createElement("g",{mask:"url(#bottom_svg__b)"},j.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M8 0 4 4 0 0",transform:"translate(4 4)"}),j.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M8 0 4 4 0 0",transform:"translate(4 8)"}))))};function B(){return(B=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}var R=function(e){return j.createElement("svg",B({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),g||(g=j.createElement("defs",null,j.createElement("path",{id:"pause_svg__a",d:"M0 0h16v16H0z"}))),j.createElement("g",null,_||(_=j.createElement("mask",{id:"pause_svg__b",fill:"#fff"},j.createElement("use",{xlinkHref:"#pause_svg__a"}))),j.createElement("g",{mask:"url(#pause_svg__b)"},j.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M13.33 6.67A6.66 6.66 0 0 0 6.67 0C2.98 0 0 2.98 0 6.67a6.66 6.66 0 0 0 6.67 6.66c3.68 0 6.66-2.98 6.66-6.66Z",transform:"translate(1.333 1.333)"}),j.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 0v4",transform:"translate(6.333 6)"}),j.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 0v4",transform:"translate(9.667 6)"}))))};function F(){return(F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}var z=function(e){return j.createElement("svg",F({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 2048 2048"},e),x||(x=j.createElement("path",{d:"M256 1088q0-26 19-45t45-19q26 0 45 19l403 402 915-914q19-19 45-19t45 19 19 45q0 26-19 45l-960 960q-19 19-45 19t-45-19l-448-448q-19-19-19-45z"})))},Y=s(37427),Q=s(37126),U=s(53794),V=s.n(U),X=s(57818),G=s(73092),J=s(5851),q=s(28870),$=s(66864),ee=s.n($),et=s(39825),es=s(78344),ea=s(25869),en=s(66648),er=s(94834),ei=s(78384);function eo(e,t){return"https://cdnjs.cloudflare.com/ajax/libs/emoji-datasource-apple/15.0.1/img/".concat(t,"/64/").concat(e,".png")}function el(e){return(0,f.jsx)(er.ZP,{width:"100%",lazyLoadEmojis:!0,theme:er.Q2.AUTO,getEmojiUrl:eo,onEmojiClick:t=>{e.onEmojiClick(t.unified)}})}function ec(e){var t;return(null===(t=e.model)||void 0===t?void 0:t.startsWith("gemini"))?(0,f.jsx)("div",{className:"no-dark",children:(0,f.jsx)(en.default,{src:"/gemini-bot.gif",alt:"Gemini Bot Icon",width:30,height:30,className:"user-avatar"})}):e.model?(0,f.jsx)("div",{className:"bot-avatar mlc-icon no-dark",children:(0,f.jsx)(ei.Z,{})}):(0,f.jsx)("div",{className:"user-avatar",children:e.avatar&&(0,f.jsx)(em,{avatar:e.avatar})})}function em(e){var t;return(0,f.jsx)(er.dy,{unified:e.avatar,size:null!==(t=e.size)&&void 0!==t?t:18,getEmojiUrl:eo})}var eh=s(96290);function ed(e){let t=e;return("string"!=typeof e&&(e=JSON.stringify(e,null,"  ")),"{}"===e)?t.toString():e.startsWith("```json")?e:["```json",e,"```"].join("\n")}var eu=s(76173),ep=s.n(eu),eg=s(72495),e_=s(7e3),ex=s.n(e_);function ef(e){let t=(0,Y.aK)().currentSession(),s=e=>e.content&&!e.isError&&!e.streaming,a=(0,y.useMemo)(()=>{var e;let s=Math.max(0,null!==(e=t.clearContextIndex)&&void 0!==e?e:0);return s===t.messages.length-1&&(s=0),t.messages.slice(s)},[t.messages,t.clearContextIndex]),n=(0,y.useMemo)(()=>a.filter((e,t)=>e.id&&s(e)&&(t>=a.length-1||s(a[t+1]))),[a]),r=n.length;(0,Y.MG)();let[i,o]=(0,y.useState)(""),[l,c]=(0,y.useState)(new Set),m=e=>0===i.length||l.has(e),h=e=>{let t=new Set;e.length>0&&n.forEach(s=>(0,Q.YK)(s).includes(e)?t.add(s.id):null),c(t)},{startIndex:d,endIndex:u,onClickIndex:p}=function(){let[e,t]=(0,y.useState)(),[s,a]=(0,y.useState)(),[n,r]=(0,y.useState)(!1);return(0,y.useEffect)(()=>{let e=e=>{"Shift"===e.key&&r(!0)},s=e=>{"Shift"===e.key&&(r(!1),t(void 0),a(void 0))};return window.addEventListener("keyup",s),window.addEventListener("keydown",e),()=>{window.removeEventListener("keyup",s),window.removeEventListener("keydown",e)}},[]),{onClickIndex:s=>{n&&void 0!==e?a(s):(t(s),a(void 0))},startIndex:e,endIndex:s}}(),g=()=>{e.updateSelection(e=>n.forEach(t=>e.add(t.id)))};return(0,y.useEffect)(()=>{e.defaultSelectAll&&g()},[]),(0,y.useEffect)(()=>{if(void 0===d||void 0===u)return;let[t,s]=[d,u].sort((e,t)=>e-t);e.updateSelection(e=>{for(let r=t;r<=s;r+=1){var a;e.add(null!==(a=n[r].id)&&void 0!==a?a:r)}})},[d,u]),(0,f.jsxs)("div",{className:ex()["message-selector"],children:[(0,f.jsxs)("div",{className:ex()["message-filter"],children:[(0,f.jsx)("input",{type:"text",placeholder:J.ZP.Select.Search,className:ex()["filter-item"]+" "+ex()["search-bar"],value:i,onInput:e=>{o(e.currentTarget.value),h(e.currentTarget.value)}}),(0,f.jsxs)("div",{className:ex().actions,children:[(0,f.jsx)(q.h,{text:J.ZP.Select.All,bordered:!0,className:ex()["filter-item"],onClick:g}),(0,f.jsx)(q.h,{text:J.ZP.Select.Latest,bordered:!0,className:ex()["filter-item"],onClick:()=>e.updateSelection(e=>{e.clear(),n.slice(r-4).forEach(t=>e.add(t.id))})}),(0,f.jsx)(q.h,{text:J.ZP.Select.Clear,bordered:!0,className:ex()["filter-item"],onClick:()=>e.updateSelection(e=>e.clear())})]})]}),(0,f.jsx)("div",{className:ex().messages,children:n.map((t,s)=>{var a;if(!m(t.id))return null;let n=null!==(a=t.id)&&void 0!==a?a:s,r=e.selection.has(n);return(0,f.jsxs)("div",{className:"".concat(ex().message," ").concat(e.selection.has(t.id)&&ex()["message-selected"]),onClick:()=>{e.updateSelection(e=>{e.has(n)?e.delete(n):e.add(n)}),p(s)},children:[(0,f.jsx)("div",{className:ex().avatar}),(0,f.jsxs)("div",{className:ex().body,children:[(0,f.jsx)("div",{className:ex().date,children:new Date(t.date).toLocaleString()}),(0,f.jsx)("div",{className:"".concat(ex().content," one-line"),children:(0,Q.YK)(t)})]}),(0,f.jsx)("div",{className:ex().checkbox,children:(0,f.jsx)("input",{type:"checkbox",checked:r,readOnly:!0})})]},s)})})]})}var ev=s(97293),ey=s(56706);let ej=(0,X.default)(async()=>(await Promise.resolve().then(s.bind(s,75038))).Markdown,{loadableGenerated:{webpack:()=>[75038]},loading:()=>(0,f.jsx)(T.Z,{})});function ew(e){return(0,f.jsx)("div",{className:"modal-template",children:(0,f.jsx)(et.u_,{title:J.ZP.Export.Title,onClose:e.onClose,footer:(0,f.jsx)("div",{style:{width:"100%",textAlign:"center",fontSize:14,opacity:.5},children:J.ZP.Exporter.Description.Title}),children:(0,f.jsx)("div",{style:{minHeight:"40vh"},children:(0,f.jsx)(eb,{})})})})}function ek(e){let t=e.steps,s=t.length;return(0,f.jsxs)("div",{className:ep().steps,children:[(0,f.jsx)("div",{className:ep()["steps-progress"],children:(0,f.jsx)("div",{className:ep()["steps-progress-inner"],style:{width:"".concat((e.index+1)/s*100,"%")}})}),(0,f.jsx)("div",{className:ep()["steps-inner"],children:t.map((t,s)=>(0,f.jsxs)("div",{className:"".concat(ep().step," ").concat(ep()[s<=e.index?"step-finished":""]," ").concat(s===e.index&&ep()["step-current"]," clickable"),onClick:()=>{var t;null===(t=e.onStepChange)||void 0===t||t.call(e,s)},role:"button",children:[(0,f.jsx)("span",{className:ep()["step-index"],children:s+1}),(0,f.jsx)("span",{className:ep()["step-name"],children:t.name})]},s))})]})}function eb(){let e=[{name:J.ZP.Export.Steps.Select,value:"select"},{name:J.ZP.Export.Steps.Preview,value:"preview"}],{currentStep:t,setCurrentStepIndex:s,currentStepIndex:a}=function(e){let t=e.length,[s,a]=(0,y.useState)(0);return{currentStepIndex:s,setCurrentStepIndex:a,nextStep:()=>a((s+1)%t),prevStep:()=>a((s-1+t)%t),currentStep:e[s]}}(e),[n,r]=(0,y.useState)({format:"image",includeContext:!0});function i(e){let t={...n};e(t),r(t)}let o=(0,Y.aK)().currentSession(),{selection:l,updateSelection:c}=function(){let[e,t]=(0,y.useState)(new Set);return{selection:e,updateSelection:s=>{let a=new Set(e);s(a),t(a)}}}(),m=(0,y.useMemo)(()=>{let e=[];return n.includeContext&&e.push(...o.template.context),e.push(...o.messages.filter(e=>l.has(e.id))),e},[n.includeContext,o.messages,o.template.context,l]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(ek,{steps:e,index:a,onStepChange:s}),(0,f.jsxs)("div",{className:ep()["message-exporter-body"],style:"select"!==t.value?{display:"none"}:{},children:[(0,f.jsxs)(et.aV,{children:[(0,f.jsx)(et.HC,{title:J.ZP.Export.Format.Title,subTitle:J.ZP.Export.Format.SubTitle,children:(0,f.jsx)(et.Ph,{value:n.format,onChange:e=>i(t=>t.format=e.currentTarget.value),children:["text","image","json"].map(e=>(0,f.jsx)("option",{value:e,children:e},e))})}),(0,f.jsx)(et.HC,{title:J.ZP.Export.IncludeContext.Title,subTitle:J.ZP.Export.IncludeContext.SubTitle,children:(0,f.jsx)("input",{type:"checkbox",checked:n.includeContext,onChange:e=>{i(t=>t.includeContext=e.currentTarget.checked)}})})]}),(0,f.jsx)(ef,{selection:l,updateSelection:c,defaultSelectAll:!0})]}),"preview"===t.value&&(0,f.jsx)("div",{className:ep()["message-exporter-body"],children:"text"===n.format?(0,f.jsx)(eZ,{messages:m,topic:o.topic}):"json"===n.format?(0,f.jsx)(eO,{messages:m,topic:o.topic}):(0,f.jsx)(eP,{messages:m,topic:o.topic})})]})}function eC(e){let t=(0,y.useRef)(null);return(0,y.useEffect)(()=>{if(!t.current)return;let s=Array.from(t.current.getElementsByClassName(ea.yY));if(s.length!==e.messages.length)return;let a=s.map((e,t)=>{var s;let[a,n]=e.id.split(":");return{id:t.toString(),role:a,content:"user"===a?null!==(s=e.textContent)&&void 0!==s?s:"":e.innerHTML,date:""}});e.onRender(a)},[]),(0,f.jsx)("div",{ref:t,children:e.messages.map((e,t)=>(0,f.jsx)("div",{id:"".concat(e.role,":").concat(t),className:ea.yY,children:(0,f.jsx)(ej,{content:(0,Q.YK)(e),defaultShow:!0})},t))})}async function eE(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=e.map(e=>({from:"user"===e.role?"human":"gpt",value:e.content}));console.log("[Share]",e,s);let a=await fetch("/sharegpt",{body:JSON.stringify({avatarUrl:t,items:s}),headers:{"Content-Type":"application/json"},method:"POST"}),n=await a.json();if(console.log("[Share]",n),n.id)return"https://shareg.pt/".concat(n.id)}function eS(e){var t;let[s,a]=(0,y.useState)(!1),[n,r]=(0,y.useState)(!1);(0,Y.MG)();let i=async()=>{var t;(null===(t=e.messages)||void 0===t?void 0:t.length)&&(a(!0),r(!0))};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsxs)("div",{className:ep()["preview-actions"],children:[e.showCopy&&(0,f.jsx)(q.h,{text:J.ZP.Export.Copy,bordered:!0,shadow:!0,icon:(0,f.jsx)(M.Z,{}),onClick:e.copy}),(0,f.jsx)(q.h,{text:J.ZP.Export.Download,bordered:!0,shadow:!0,icon:(0,f.jsx)(eg.Z,{}),onClick:e.download}),(0,f.jsx)(q.h,{text:J.ZP.Export.Share,bordered:!0,shadow:!0,icon:s?(0,f.jsx)(T.Z,{}):(0,f.jsx)(k,{}),onClick:i})]}),(0,f.jsx)("div",{style:{position:"fixed",right:"200vw",pointerEvents:"none"},children:n&&(0,f.jsx)(eC,{messages:null!==(t=e.messages)&&void 0!==t?t:[],onRender:e=>{r(!1),eE(e).then(e=>{e&&((0,et.K4)({title:J.ZP.Export.Share,children:[(0,f.jsx)("input",{type:"text",value:e,style:{width:"100%",maxWidth:"unset"},readOnly:!0,onClick:e=>e.currentTarget.select()},"input")],actions:[(0,f.jsx)(q.h,{icon:(0,f.jsx)(M.Z,{}),text:J.ZP.Chat.Actions.Copy,onClick:()=>(0,Q.vQ)(e)},"copy")]}),setTimeout(()=>{window.open(e,"_blank")},800))}).catch(e=>{console.error("[Share]",e),(0,et.CF)(ed(e))}).finally(()=>a(!1))}})})]})}function eN(e){return e.avatar===ey.Vx?(0,f.jsx)("div",{className:"bot-avatar no-dark",children:(0,f.jsx)(ei.Z,{})}):(0,f.jsx)(ec,{avatar:e.avatar})}function eP(e){var t,s;let a=(0,Y.aK)().currentSession(),n=a.template,r=(0,Y.MG)(),i=(0,y.useRef)(null),o=(0,Q.S0)(),l=async()=>{(0,et.CF)(J.ZP.Export.Image.Toast);let t=i.current;if(t)try{let s=await (0,ev.YM)(t,{includeQueryParams:!0});if(!s)return;if(o)(0,et.vi)(s);else{let t=document.createElement("a");t.download="".concat(e.topic,".png"),t.href=s,t.click(),c()}}catch(e){(0,et.CF)(J.ZP.Download.Failed)}},c=()=>{let e=i.current;e&&(e.innerHTML=e.innerHTML)};return(0,f.jsxs)("div",{className:ep()["image-previewer"],children:[(0,f.jsx)(eS,{copy:()=>{(0,et.CF)(J.ZP.Export.Image.Toast);let e=i.current;e&&(0,ev.SE)(e).then(e=>{if(e)try{navigator.clipboard.write([new ClipboardItem({"image/png":e})]).then(()=>{(0,et.CF)(J.ZP.Copy.Success),c()})}catch(e){console.error("[Copy Image] ",e),(0,et.CF)(J.ZP.Copy.Failed)}})},download:l,showCopy:!o,messages:e.messages}),(0,f.jsxs)("div",{className:"".concat(ep()["preview-body"]," ").concat(ep()["default-theme"]),ref:i,children:[(0,f.jsxs)("div",{className:ep()["chat-info"],children:[(0,f.jsx)("div",{className:ep().logo+" no-dark",children:(0,f.jsx)(ei.Z,{})}),(0,f.jsxs)("div",{children:[(0,f.jsx)("div",{className:ep()["main-title"],children:"WebLLM Chat"}),(0,f.jsx)("div",{className:ep()["sub-title"],children:window.location.host})]}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("div",{className:ep()["chat-info-item"],children:[J.ZP.Exporter.Model,": ",r.modelConfig.model]}),(0,f.jsxs)("div",{className:ep()["chat-info-item"],children:[J.ZP.Exporter.Messages,": ",e.messages.length]}),(0,f.jsxs)("div",{className:ep()["chat-info-item"],children:[J.ZP.Exporter.Topic,": ",a.topic]}),(0,f.jsxs)("div",{className:ep()["chat-info-item"],children:[J.ZP.Exporter.Time,":"," ",new Date(null!==(s=null===(t=e.messages.at(-1))||void 0===t?void 0:t.date)&&void 0!==s?s:Date.now()).toLocaleString()]})]})]}),e.messages.map((e,t)=>(0,f.jsxs)("div",{className:ep().message+" "+ep()["message-"+e.role],children:["user"!==e.role&&(0,f.jsx)("div",{className:ep().avatar,children:(0,f.jsx)(eN,{avatar:n.avatar})}),(0,f.jsxs)("div",{className:ep().body,children:[(0,f.jsx)(ej,{content:(0,Q.YK)(e),fontSize:r.fontSize,defaultShow:!0}),1==(0,Q.Bs)(e).length&&(0,f.jsx)("img",{src:(0,Q.Bs)(e)[0],alt:"message",className:ep()["message-image"]},t),(0,Q.Bs)(e).length>1&&(0,f.jsx)("div",{className:ep()["message-images"],style:{"--image-count":(0,Q.Bs)(e).length},children:(0,Q.Bs)(e).map((e,t)=>(0,f.jsx)("img",{src:e,alt:"message",className:ep()["message-image-multi"]},t))})]})]},t))]})]})}function eZ(e){let t="# ".concat(e.topic,"\n\n")+e.messages.map(e=>"user"===e.role?"## ".concat(J.ZP.Export.MessageFromYou,":\n").concat((0,Q.YK)(e)):"## ".concat(J.ZP.Export.MessageFromWebLLM,":\n").concat((0,Q.YK)(e).trim())).join("\n\n");return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(eS,{copy:()=>{(0,Q.vQ)(t)},download:()=>{(0,Q.CP)(t,"".concat(e.topic,".md"))},showCopy:!0,messages:e.messages}),(0,f.jsx)("div",{className:"markdown-body",children:(0,f.jsx)("pre",{className:ep()["export-content"],children:t})})]})}function eO(e){let t={messages:[{role:"system",content:"".concat(J.ZP.FineTuned.Sysmessage," ").concat(e.topic)},...e.messages.map(e=>({role:e.role,content:e.content}))]},s="```json\n"+JSON.stringify(t,null,2)+"\n```",a=JSON.stringify(t),n=()=>{(0,Q.vQ)(a)};return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(eS,{copy:n,download:()=>{(0,Q.CP)(JSON.stringify(t),"".concat(e.topic,".json"))},showCopy:!1,messages:e.messages}),(0,f.jsx)("div",{className:"markdown-body",onClick:n,children:(0,f.jsx)(ej,{content:s})})]})}var eM=s(35193);function eT(e){return(0,f.jsx)("div",{className:ee()["toast-container"]+(e.show?" ".concat(ee().show):""),children:(0,f.jsx)("div",{className:ee()["toast-content"],onClick:()=>e.onclick(),children:(0,f.jsx)(L,{})})})}function eD(e){let[t,s]=(0,y.useState)(!1);(0,Y.MG)();let a=(0,Y.aK)(),n=a.currentSession(),r=(0,ey.dk)(),i=(0,es.s0)(),o=e=>{let t={...n.template};e(t),a.updateCurrentSession(e=>e.template=t)};return(0,f.jsx)("div",{className:"modal-template",children:(0,f.jsx)(et.u_,{title:J.ZP.Context.Edit,onClose:()=>e.onClose(),actions:[(0,f.jsx)(q.h,{icon:(0,f.jsx)(H.Z,{}),bordered:!0,text:J.ZP.Chat.Config.Reset,onClick:async()=>{await (0,et.i0)(J.ZP.Memory.ResetConfirm)&&a.updateCurrentSession(e=>e.memoryPrompt="")}},"reset"),(0,f.jsx)(q.h,{icon:(0,f.jsx)(M.Z,{}),bordered:!0,text:J.ZP.Chat.Config.SaveAs,onClick:()=>{(0,et.G5)(J.ZP.Template.Config.Name,n.topic,1).then(e=>{o(t=>{t.name=e}),i(ea.y$.Templates),setTimeout(()=>{r.create(n.template)},500)})}},"copy"),(0,f.jsx)(q.h,{type:"primary",icon:(0,f.jsx)(W.Z,{}),bordered:!0,text:J.ZP.Chat.Config.Confirm,onClick:e.onClose},"ok")],children:(0,f.jsxs)(et.aV,{children:[(0,f.jsx)(et.HC,{title:J.ZP.Chat.EditMessage.Topic.Title,subTitle:J.ZP.Chat.EditMessage.Topic.SubTitle,children:(0,f.jsx)("input",{type:"text",value:n.topic,onInput:e=>a.updateCurrentSession(t=>t.topic=e.currentTarget.value)})}),(0,f.jsx)(et.HC,{title:J.ZP.Template.Config.Avatar,children:(0,f.jsx)(et.J2,{content:(0,f.jsx)(el,{onEmojiClick:e=>{o(t=>t.avatar=e),s(!1)}}),open:t,onClose:()=>s(!1),children:(0,f.jsx)("div",{onClick:()=>s(!0),style:{cursor:"pointer"}})})}),(0,f.jsx)(et.HC,{title:J.ZP.Template.Config.HideContext.Title,subTitle:J.ZP.Template.Config.HideContext.SubTitle,children:(0,f.jsx)("input",{type:"checkbox",checked:n.template.hideContext,onChange:e=>{o(t=>{t.hideContext=e.currentTarget.checked})}})})]})})})}let eK=(0,X.default)(async()=>(await Promise.resolve().then(s.bind(s,75038))).Markdown,{loadableGenerated:{webpack:()=>[75038]},loading:()=>(0,f.jsx)(T.Z,{})});function eH(e){let t=0===e.prompts.length,[s,a]=(0,y.useState)(0),n=(0,y.useRef)(null);return((0,y.useEffect)(()=>{a(0)},[e.prompts.length]),(0,y.useEffect)(()=>{let r=r=>{if(t||r.metaKey||r.altKey||r.ctrlKey)return;let i=t=>{var i;r.stopPropagation(),r.preventDefault(),a(Math.max(0,Math.min(e.prompts.length-1,s+t))),null===(i=n.current)||void 0===i||i.scrollIntoView({block:"center"})};if("ArrowUp"===r.key)i(1);else if("ArrowDown"===r.key)i(-1);else if("Enter"===r.key){let t=e.prompts.at(s);t&&e.onPromptSelect(t)}};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[e.prompts.length,s]),t)?null:(0,f.jsx)("div",{className:ee()["prompt-hints"],children:e.prompts.map((t,r)=>(0,f.jsxs)("div",{ref:r===s?n:null,className:ee()["prompt-hint"]+" ".concat(r===s?ee()["prompt-hint-selected"]:""),onClick:()=>e.onPromptSelect(t),onMouseEnter:()=>a(r),children:[(0,f.jsx)("div",{className:ee()["hint-title"],children:t.title}),(0,f.jsx)("div",{className:ee()["hint-content"],children:t.content})]},t.title+r.toString()))})}function eI(){let e=(0,Y.aK)();return(0,f.jsxs)("div",{className:ee()["clear-context"],onClick:()=>e.updateCurrentSession(e=>e.clearContextIndex=void 0),children:[(0,f.jsx)("div",{className:ee()["clear-context-tips"],children:J.ZP.Context.Clear}),(0,f.jsx)("div",{className:ee()["clear-context-revert-btn"],children:J.ZP.Context.Revert})]})}function eW(e){let t=(0,y.useRef)(null),s=(0,y.useRef)(null),[a,n]=(0,y.useState)({full:16,icon:16});function r(){if(!t.current||!s.current)return;let e=s.current.getBoundingClientRect().width,a=t.current.getBoundingClientRect().width;n({full:e+a,icon:a})}return e.fullWidth?(0,f.jsxs)("div",{className:"".concat(ee()["chat-input-action"]," clickable ").concat(ee()["full-width"]),onClick:e.onClick,children:[(0,f.jsx)("div",{ref:t,className:ee().icon,children:e.icon}),(0,f.jsx)("div",{className:ee().text,ref:s,children:e.text})]}):(0,f.jsxs)("div",{className:"".concat(ee()["chat-input-action"]," clickable"),onClick:()=>{!e.loding&&(e.onClick(),t&&setTimeout(r,1))},onMouseEnter:e.icon?r:void 0,onTouchStart:e.icon?r:void 0,style:e.icon&&!e.loding?{"--icon-width":"".concat(a.icon,"px"),"--full-width":"".concat(a.full,"px"),...e.style}:e.loding?{"--icon-width":"30px","--full-width":"30px",...e.style}:e.style,children:[e.icon?(0,f.jsx)("div",{ref:t,className:ee().icon,children:e.loding?(0,f.jsx)(T.Z,{}):e.icon}):null,(0,f.jsx)("div",{className:e.icon&&!e.loding?ee().text:void 0,ref:s,children:!e.loding&&e.text}),e.innerNode]})}function eA(e){return(0,f.jsx)("div",{className:ee()["delete-image"],onClick:e.deleteImage,children:(0,f.jsx)(I.Z,{})})}function eL(e){return(0,f.jsx)("div",{className:ee()["delete-file"],onClick:e.deleteFile,children:(0,f.jsx)(I.Z,{})})}function eB(){var e,t;let s=(0,Y.aK)(),a=s.currentSession(),n=(0,Y.MG)(),r=n.fontSize,i=a.messages.some(e=>e.streaming),[o,l]=(0,y.useState)(!1),c=(0,y.useRef)(null),[m,h]=(0,y.useState)(""),[d,u]=(0,y.useState)(!1),{submitKey:p,shouldSubmit:g}=function(){let e=(0,Y.MG)(),t=e.submitKey,s=(0,y.useRef)(!1);return(0,y.useEffect)(()=>{let e=()=>{s.current=!0},t=()=>{s.current=!1};return window.addEventListener("compositionstart",e),window.addEventListener("compositionend",t),()=>{window.removeEventListener("compositionstart",e),window.removeEventListener("compositionend",t)}},[]),{submitKey:t,shouldSubmit:t=>229!=t.keyCode&&"Enter"===t.key&&("Enter"!==t.key||!t.nativeEvent.isComposing&&!s.current)&&(e.submitKey===Y.mQ.AltEnter&&t.altKey||e.submitKey===Y.mQ.CtrlEnter&&t.ctrlKey||e.submitKey===Y.mQ.ShiftEnter&&t.shiftKey||e.submitKey===Y.mQ.MetaEnter&&t.metaKey||e.submitKey===Y.mQ.Enter&&!t.altKey&&!t.ctrlKey&&!t.shiftKey&&!t.metaKey)}}(),_=(0,y.useRef)(null),x=null!=_&&!!_.current&&1>=Math.abs(_.current.scrollHeight-(_.current.scrollTop+_.current.clientHeight)),{setAutoScroll:j,scrollDomToBottom:w}=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],[s,a]=(0,y.useState)(!0);function n(){let t=e.current;t&&requestAnimationFrame(()=>{a(!0),t.scrollTo(0,t.scrollHeight)})}return(0,y.useEffect)(()=>{s&&!t&&n()}),{scrollRef:e,autoScroll:s,setAutoScroll:a,scrollDomToBottom:n}}(_,x),[b,E]=(0,y.useState)(!0),N=(0,Q.S0)(),Z=(0,es.s0)(),[T,W]=(0,y.useState)([]),[A,L]=(0,y.useState)(!1),[B,F]=(0,y.useState)(!1),U=(0,y.useContext)(eM.J),X=(0,G.f)(),[$,en]=(0,y.useState)([]),er=(0,v.y1)(e=>{en(X.search(e))},100,{leading:!0,trailing:!0}),[ei,eo]=(0,y.useState)(2),el=(0,v.y1)(()=>{let e=c.current?(0,Q.lx)(c.current):1;eo(Math.min(20,Math.max(2+Number(!N),e)))},100,{leading:!0,trailing:!0});(0,y.useEffect)(el,[m]);let ec=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};function t(e){return e.startsWith(":")?e.slice(1):e}return{match:function(s){let a=t(s),n="function"==typeof e[a];return{matched:n,invoke:()=>n&&e[a](s)}},search:function(s){let a=t(s),n=J.ZP.Chat.Commands;return Object.keys(e).filter(e=>e.startsWith(a)).map(e=>({title:n[e],content:":"+e}))}}}({new:()=>s.newSession(),prev:()=>s.nextSession(-1),next:()=>s.nextSession(1),clear:()=>s.updateCurrentSession(e=>e.clearContextIndex=e.messages.length),del:()=>s.deleteSession(s.currentSessionIndex)}),em=e=>{h(e);let t=e.trim().length;0===t?en([]):e.startsWith(":")?en(ec.search(e)):!n.disablePromptHint&&t<30&&e.startsWith("/")&&er(e.slice(1))},eu=e=>{var t;if(""===e.trim())return;let a=ec.match(e);if(a.matched){h(""),en([]),a.invoke();return}i||(u(!0),s.onUserInput(e,U,T).then(()=>u(!1)),W([]),localStorage.setItem(ea.Sb,e),h(""),en([]),N||null===(t=c.current)||void 0===t||t.focus(),j(!0))},ep=()=>{U.abort(),s.stopStreaming()};(0,y.useEffect)(()=>{s.resetGeneratingStatus()},[]),(0,y.useEffect)(()=>{s.updateCurrentSession(e=>{let t=Date.now()-ea.tb;e.messages.forEach(e=>{(e.isError||new Date(e.date).getTime()<t)&&(e.streaming&&(e.streaming=!1),0===e.content.length&&(e.isError=!0,e.content=ed({error:!0,message:"empty response"})))}),e.messages=e.messages.filter(e=>e.content.length>0)}),(0,Q.vU)()&&(n.sttConfig.engine=ea.dl)},[]);let eg=(e,t)=>{(0,Q.Ri)(e.currentTarget,(0,Q.YK)(t))&&(0===m.length&&h((0,Q.YK)(t)),e.preventDefault())},e_=e=>{s.updateCurrentSession(t=>t.messages=t.messages.filter(t=>t.id!==e))},ex=e=>{e_(e)},ef=e=>{var t;let n,r;let i=a.messages.findIndex(t=>t.id===e.id);if(i<0||i>=a.messages.length){console.error("[Chat] failed to find resending message",e);return}if("assistant"===e.role){r=e;for(let e=i;e>=0;e-=1)if("user"===a.messages[e].role){n=a.messages[e];break}}else if("user"===e.role){n=e;for(let e=i;e<a.messages.length;e+=1)if("assistant"===a.messages[e].role){r=a.messages[e];break}}if(void 0===n){console.error("[Chat] failed to resend",e);return}e_(n.id),e_(null==r?void 0:r.id),u(!0);let o=(0,Q.YK)(n),l=(0,Q.Bs)(n);s.onUserInput(o,U,l).then(()=>u(!1)),null===(t=c.current)||void 0===t||t.focus()},ev=(0,y.useMemo)(()=>a.template.hideContext?[]:a.template.context.slice(),[a.template.context,a.template.hideContext]);if(0===ev.length&&(null===(e=a.messages.at(0))||void 0===e?void 0:e.content)!==Y.ux.content){let e=Object.assign({},Y.ux);ev.push(e)}let ey=(0,y.useMemo)(()=>ev.concat(a.messages).concat(m.length>0&&n.sendPreviewBubble?[{...(0,Y.tn)({role:"user",content:m}),preview:!0}]:[]),[n.sendPreviewBubble,ev,d,a.messages,m]),[ej,ek]=(0,y.useState)(Math.max(0,ey.length-ea.nS));function eb(e){ek(e=Math.max(0,e=Math.min(ey.length-ea.nS,e)))}let eC=(0,y.useMemo)(()=>{let e=Math.min(ej+3*ea.nS,ey.length);return ey.slice(ej,e)},[ej,ey]),eE=e=>{let t=e.scrollTop+e.clientHeight,s=e.clientHeight,a=e.scrollTop<=s,n=t>=e.scrollHeight-s,r=t>=e.scrollHeight-(N?4:10),i=ej-ea.nS,o=ej+ea.nS;a&&!n?eb(i):n&&eb(o),E(r),j(r)};function eS(){eb(ey.length-ea.nS),w()}let eN=(null!==(t=a.clearContextIndex)&&void 0!==t?t:-1)>=0?a.clearContextIndex+ev.length-ej:-1;!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,s]=(0,eh.lr)();(0,y.useEffect)(()=>{let a=!1;t.forEach((s,n)=>{"function"==typeof e[n]&&(e[n](s),t.delete(n),a=!0)}),a&&s(t)},[t,e])}({fill:h,submit:e=>{eu(e)}}),(0,y.useEffect)(()=>{let e=(0,ea.AI)(a.id),t=localStorage.getItem(e);t&&0===m.length&&(h(t),localStorage.removeItem(e));let s=c.current;return()=>{var t;localStorage.setItem(e,null!==(t=null==s?void 0:s.value)&&void 0!==t?t:"")}},[]);let eP=(0,y.useCallback)(async e=>{let t=n.modelConfig.model;if((0,Q.Xf)(t)){for(let t of(e.clipboardData||window.clipboardData).items)if("file"===t.kind&&t.type.startsWith("image/")){e.preventDefault();let s=t.getAsFile();if(s){let e=[];e.push(...T),e.push(...await new Promise((e,t)=>{L(!0);let a=[];(function(e,t){return new Promise((t,s)=>{let a=new FileReader;a.onload=e=>{let a=new Image;a.onload=()=>{let e,s=document.createElement("canvas"),n=s.getContext("2d"),r=a.width,i=a.height,o=.9;do{if(s.width=r,s.height=i,null==n||n.clearRect(0,0,s.width,s.height),null==n||n.drawImage(a,0,0,r,i),(e=s.toDataURL("image/jpeg",o)).length<262144)break;o>.5?o-=.1:(r*=.9,i*=.9)}while(e.length>262144);t(e)},a.onerror=s,a.src=e.target.result},a.onerror=s,e.type.includes("heic")&&V()({blob:e,toType:"image/jpeg"}).then(e=>{a.readAsDataURL(e)}).catch(e=>{s(e)}),a.readAsDataURL(e)})})(s,0).then(t=>{a.push(t),L(!1),e(a)}).catch(e=>{L(!1),t(e)})}));let t=e.length;t>3&&e.splice(3,t-3),W(e)}}}},[T,s]);return(0,f.jsxs)("div",{className:ee().chat,children:[(0,f.jsxs)("div",{className:"window-header",children:[N&&(0,f.jsx)("div",{className:"window-actions",children:(0,f.jsx)("div",{className:"window-action-button",children:(0,f.jsx)(q.h,{icon:(0,f.jsx)(O,{}),bordered:!0,title:J.ZP.Chat.Actions.ChatList,onClick:()=>Z(ea.y$.Home)})})}),(0,f.jsxs)("div",{className:"window-header-title ".concat(ee()["chat-body-title"]),children:[(0,f.jsx)("div",{className:"window-header-main-title ".concat(ee()["chat-body-main-title"]),onClickCapture:()=>F(!0),children:a.topic?a.topic:Y.HX}),(0,f.jsx)("div",{className:"window-header-sub-title",children:J.ZP.Chat.SubTitle(a.messages.length)})]}),(0,f.jsxs)("div",{className:"window-actions",children:[!N&&(0,f.jsx)("div",{className:"window-action-button",children:(0,f.jsx)(q.h,{icon:(0,f.jsx)(S,{}),bordered:!0,onClick:()=>F(!0)})}),(0,f.jsx)("div",{className:"window-action-button",children:(0,f.jsx)(q.h,{icon:(0,f.jsx)(k,{}),bordered:!0,title:J.ZP.Chat.Actions.Share,onClick:()=>{let e=new URLSearchParams({model:n.modelConfig.model,temperature:n.modelConfig.temperature.toString(),top_p:n.modelConfig.top_p.toString(),max_tokens:n.modelConfig.max_tokens.toString(),presence_penalty:n.modelConfig.presence_penalty.toString(),frequency_penalty:n.modelConfig.frequency_penalty.toString()}),t=new URL("".concat(window.location.origin).concat(window.location.pathname,"?").concat(e));(0,Q.vQ)(t.href)}})}),(0,f.jsx)("div",{className:"window-action-button",children:(0,f.jsx)(q.h,{icon:(0,f.jsx)(P,{}),bordered:!0,title:J.ZP.Chat.Actions.Export,onClick:()=>{l(!0)}})}),!N&&(0,f.jsx)("div",{className:"window-action-button",children:(0,f.jsx)(q.h,{icon:n.tightBorder?(0,f.jsx)(K.Z,{}):(0,f.jsx)(D.Z,{}),bordered:!0,onClick:()=>{n.update(e=>e.tightBorder=!e.tightBorder)}})})]})]}),(0,f.jsxs)("div",{className:ee()["chat-body"],ref:_,onScroll:e=>eE(e.currentTarget),onMouseDown:()=>{var e;return null===(e=c.current)||void 0===e?void 0:e.blur()},onTouchStart:()=>{var e;null===(e=c.current)||void 0===e||e.blur(),j(!1)},children:[(0,f.jsx)("div",{className:ee()["chat-action-context"],children:(0,f.jsx)(eW,{text:J.ZP.Chat.Actions.EditPrompts,icon:(0,f.jsx)(S,{}),onClick:()=>F(!0),fullWidth:!0})}),eC.map((e,t)=>{let a="user"===e.role,i=t<ev.length,o=t>0&&!(e.preview||0===e.content.length)&&!i,l=e.preview||e.streaming;return(0,f.jsxs)(y.Fragment,{children:[(0,f.jsx)("div",{className:a?ee()["chat-message-user"]:ee()["chat-message"],children:(0,f.jsxs)("div",{className:ee()["chat-message-container"],children:[(0,f.jsxs)("div",{className:ee()["chat-message-header"],children:[(0,f.jsx)("div",{className:ee()["chat-message-avatar"]}),(0,f.jsxs)("div",{className:ee()["chat-message-role-name-container"],children:["system"===e.role&&(0,f.jsx)("div",{className:"".concat(ee()["chat-message-role-name"]," ").concat(ee()["no-hide"]),children:J.ZP.Chat.Roles.System}),"assistant"===e.role&&(0,f.jsx)("div",{className:ee()["chat-message-role-name"],children:n.models.find(t=>t.name===e.model)?n.models.find(t=>t.name===e.model).display_name:e.model}),o&&(0,f.jsx)("div",{className:ee()["chat-message-actions"],children:(0,f.jsxs)("div",{className:ee()["chat-input-actions"],children:[(0,f.jsx)(eW,{text:J.ZP.Chat.Actions.Edit,icon:(0,f.jsx)(S,{}),onClick:async()=>{let t=await (0,et.G5)(J.ZP.Chat.Actions.Edit,(0,Q.YK)(e),10),a=t,n=(0,Q.Bs)(e);if(n.length>0){a=[{type:"text",text:t}];for(let e=0;e<n.length;e++)a.push({type:"image_url",image_url:{url:n[e]}})}s.updateCurrentSession(t=>{let s=t.template.context.concat(t.messages).find(t=>t.id===e.id);s&&(s.content=a)})}}),e.streaming?(0,f.jsx)(eW,{text:J.ZP.Chat.Actions.Stop,icon:(0,f.jsx)(R,{}),onClick:()=>ep()}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(eW,{text:J.ZP.Chat.Actions.Retry,icon:(0,f.jsx)(H.Z,{}),onClick:()=>ef(e)}),(0,f.jsx)(eW,{text:J.ZP.Chat.Actions.Delete,icon:(0,f.jsx)(I.Z,{}),onClick:()=>{var s;return ex(null!==(s=e.id)&&void 0!==s?s:t)}}),(0,f.jsx)(eW,{text:J.ZP.Chat.Actions.Copy,icon:(0,f.jsx)(M.Z,{}),onClick:()=>(0,Q.vQ)((0,Q.YK)(e))})]})]})})]})]}),!a&&e.toolMessages&&e.toolMessages.map((e,t)=>(0,f.jsx)("div",{className:ee()["chat-message-tools-status"],children:(0,f.jsxs)("div",{className:ee()["chat-message-tools-name"],children:[(0,f.jsx)(z,{className:ee()["chat-message-checkmark"]}),e.toolName,":",(0,f.jsx)("code",{className:ee()["chat-message-tools-details"],children:e.toolInput})]})},t)),l&&(0,f.jsx)("div",{className:ee()["chat-message-status"],children:J.ZP.Chat.Typing}),(0,f.jsxs)("div",{className:ee()["chat-message-item"],children:[(0,f.jsx)(eK,{content:(0,Q.YK)(e),loading:(e.preview||e.streaming)&&0===e.content.length&&!a,onContextMenu:t=>eg(t,e),onDoubleClickCapture:()=>{N&&h((0,Q.YK)(e))},fontSize:r,parentRef:_,defaultShow:t>=eC.length-6}),1==(0,Q.Bs)(e).length&&(0,f.jsx)("img",{className:ee()["chat-message-item-image"],src:(0,Q.Bs)(e)[0],alt:""}),(0,Q.Bs)(e).length>1&&(0,f.jsx)("div",{className:ee()["chat-message-item-images"],style:{"--image-count":(0,Q.Bs)(e).length},children:(0,Q.Bs)(e).map((e,t)=>(0,f.jsx)("img",{className:ee()["chat-message-item-image-multi"],src:e,alt:""},t))})]}),(0,f.jsx)("div",{className:ee()["chat-message-action-date"],children:i?J.ZP.Chat.IsContext:e.date.toLocaleString()})]})}),t===eN-1&&(0,f.jsx)(eI,{})]},"".concat(t,"/").concat(e.id))})]}),(0,f.jsxs)("div",{className:ee()["chat-input-panel"],children:[(0,f.jsx)(eT,{onclick:eS,show:!b}),(0,f.jsx)(eH,{prompts:$,onPromptSelect:e=>{setTimeout(()=>{var t;en([]);let s=ec.match(e.content);s.matched?(s.invoke(),h("")):h(e.content),null===(t=c.current)||void 0===t||t.focus()},30)}}),(0,f.jsxs)("label",{className:"".concat(ee()["chat-input-panel-inner"]," ").concat(0!=T.length?ee()["chat-input-panel-inner-attach"]:""),htmlFor:"chat-input",children:[(0,f.jsx)("textarea",{id:"chat-input",ref:c,className:ee()["chat-input"],placeholder:J.ZP.Chat.Input(p),onInput:e=>em(e.currentTarget.value),value:m,onKeyDown:e=>{if("ArrowUp"===e.key&&m.length<=0&&!(e.metaKey||e.altKey||e.ctrlKey)){var t;h(null!==(t=localStorage.getItem(ea.Sb))&&void 0!==t?t:""),e.preventDefault();return}g(e)&&0===$.length&&(eu(m),e.preventDefault())},onFocus:eS,onClick:eS,onPaste:eP,rows:ei,autoFocus:!N,style:{fontSize:n.fontSize}}),0!=T.length&&(0,f.jsx)("div",{className:ee()["attach-images"],children:T.map((e,t)=>(0,f.jsx)("div",{className:ee()["attach-image"],style:{backgroundImage:'url("'.concat(e,'")')},children:(0,f.jsx)("div",{className:ee()["attach-image-template"],children:(0,f.jsx)(eA,{deleteImage:()=>{W(T.filter((e,s)=>s!==t))}})})},t))}),i?(0,f.jsx)(q.h,{icon:(0,f.jsx)(R,{}),text:J.ZP.Chat.InputActions.Stop,className:ee()["chat-input-send"],type:"primary",onClick:()=>ep()}):(0,f.jsx)(q.h,{icon:(0,f.jsx)(C,{}),text:J.ZP.Chat.Send,className:ee()["chat-input-send"],type:"primary",onClick:()=>eu(m)})]})]}),o&&(0,f.jsx)(ew,{onClose:()=>l(!1)}),B&&(0,f.jsx)(eD,{onClose:()=>F(!1)})]},a.id)}function eR(){let e=(0,Y.aK)().currentSessionIndex;return(0,f.jsx)(eB,{},e)}},73092:function(e,t,s){"use strict";s.d(t,{f:function(){return c},o:function(){return l}});var a=s(86578),n=s(5851),r=s(25869),i=s(72290),o=s(37993);let l={ready:!1,builtinEngine:new a.Z([],{keys:["title"]}),userEngine:new a.Z([],{keys:["title"]}),count:{builtin:0},allPrompts:[],builtinPrompts:[],init(e,t){this.ready||(this.allPrompts=t.concat(e),this.builtinPrompts=e.slice(),this.builtinEngine.setCollection(e),this.userEngine.setCollection(t),this.ready=!0)},remove(e){this.userEngine.remove(t=>t.id===e)},add(e){this.userEngine.add(e)},search(e){let t=this.userEngine.search(e),s=this.builtinEngine.search(e);return t.concat(s).map(e=>e.item)}},c=(0,o.D)({counter:0,prompts:{}},(e,t)=>({add(s){let a=t().prompts;return s.id=(0,i.x0)(),s.isUser=!0,s.createdAt=Date.now(),a[s.id]=s,e(()=>({prompts:a})),s.id},get:e=>t().prompts[e]||l.builtinPrompts.find(t=>t.id===e),remove(s){let a=t().prompts;delete a[s],Object.entries(a).some(e=>{let[t,n]=e;return n.id===s&&(delete a[t],!0)}),l.remove(s),e(()=>({prompts:a,counter:t().counter+1}))},getUserPrompts(){var e;let s=Object.values(null!==(e=t().prompts)&&void 0!==e?e:{});return s.sort((e,t)=>t.id&&e.id?t.createdAt-e.createdAt:0),s},updatePrompt(s,a){var n;let r=null!==(n=t().prompts[s])&&void 0!==n?n:{title:"",content:"",id:s};l.remove(s),a(r);let i=t().prompts;i[s]=r,e(()=>({prompts:i})),l.add(r)},search(e){return 0===e.length?this.getUserPrompts().concat(l.builtinPrompts):l.search(e)}}),{name:r.KJ.Prompt,onRehydrateStorage(e){fetch("./prompts.json").then(e=>e.json()).then(e=>{var t;let s=[e.en,e.cn];"cn"===(0,n.VQ)()&&(s=s.reverse());let a=s.map(e=>e.map(e=>{let[t,s]=e;return{id:(0,i.x0)(),title:t,content:s,createdAt:Date.now()}})),r=null!==(t=c.getState().getUserPrompts())&&void 0!==t?t:[],o=a.reduce((e,t)=>e.concat(t),[]).filter(e=>!!e.title&&!!e.content);l.count.builtin=e.en.length+e.cn.length,l.init(o,r)})}})},66864:function(e){e.exports={"attach-files":"chat_attach-files__IgWzs","attach-file":"chat_attach-file__81pBy","attach-file-info":"chat_attach-file-info__wFm95","attach-file-mask":"chat_attach-file-mask__4a_c8","delete-file":"chat_delete-file__rPNvI","attach-images":"chat_attach-images__UtJds","attach-image":"chat_attach-image__5zxeG","attach-image-template":"chat_attach-image-template__P_SQp","delete-image":"chat_delete-image__IBtAc","chat-input-actions":"chat_chat-input-actions__mwYC_","chat-input-action":"chat_chat-input-action__DMW7Y","slide-in":"chat_slide-in__nvZgA",text:"chat_text__TkPfN","full-width":"chat_full-width__RdaYc",icon:"chat_icon__Ly3TN","prompt-toast":"chat_prompt-toast___VCUf","prompt-toast-inner":"chat_prompt-toast-inner__f17E6","slide-in-from-top":"chat_slide-in-from-top__Q0KCt","prompt-toast-content":"chat_prompt-toast-content__9sp_w","section-title":"chat_section-title__BiPko","section-title-action":"chat_section-title-action__bmruw","context-prompt":"chat_context-prompt__cbach","context-prompt-insert":"chat_context-prompt-insert__UmNJi","context-prompt-row":"chat_context-prompt-row__3Kbix","context-drag":"chat_context-drag__BX7lh","context-role":"chat_context-role__7_IR9","context-content":"chat_context-content__sNXUy","context-delete-button":"chat_context-delete-button__C_BmS","context-prompt-button":"chat_context-prompt-button__AoPsw","memory-prompt":"chat_memory-prompt__vOzcn","memory-prompt-content":"chat_memory-prompt-content__kUVKj","clear-context":"chat_clear-context__ke8Iw","clear-context-tips":"chat_clear-context-tips__L1A_i","clear-context-revert-btn":"chat_clear-context-revert-btn___Wna1",chat:"chat_chat__ZebHg","chat-body":"chat_chat-body__QFv5x","chat-action-context":"chat_chat-action-context__OnuV9","chat-body-main-title":"chat_chat-body-main-title__jUL6h","chat-body-title":"chat_chat-body-title__d2ItC","chat-message":"chat_chat-message__dg8rL","chat-message-user":"chat_chat-message-user__ZtTEj","chat-message-header":"chat_chat-message-header__Dny_K","chat-message-actions":"chat_chat-message-actions__H90hg","chat-message-container":"chat_chat-message-container__O_X8_","chat-message-role-name-container":"chat_chat-message-role-name-container__MVbul","chat-message-role-name":"chat_chat-message-role-name__8lixl","no-hide":"chat_no-hide__XA_H4","chat-message-checkmark":"chat_chat-message-checkmark__cBC67","chat-message-tools-status":"chat_chat-message-tools-status__QD2Th","chat-message-tools-name":"chat_chat-message-tools-name__Mj2Qc","chat-message-tools-details":"chat_chat-message-tools-details__nwup9","chat-message-status":"chat_chat-message-status__zc9Ad","chat-message-item":"chat_chat-message-item__dKqMl","chat-message-item-files":"chat_chat-message-item-files__xZP0P","chat-message-item-file":"chat_chat-message-item-file__2JG_c","chat-message-item-image":"chat_chat-message-item-image__2jbb0","chat-message-item-images":"chat_chat-message-item-images__EtEM4","chat-message-item-image-multi":"chat_chat-message-item-image-multi__DOIxY","chat-message-action-date":"chat_chat-message-action-date__RsXTn","chat-input-panel":"chat_chat-input-panel__rO72m","prompt-hints":"chat_prompt-hints__VT_Oi","prompt-hint":"chat_prompt-hint__2616t","hint-title":"chat_hint-title__E53ZK","hint-content":"chat_hint-content__y2yj4","prompt-hint-selected":"chat_prompt-hint-selected__o3vYi","chat-input-panel-inner":"chat_chat-input-panel-inner___IQHi","chat-input-panel-inner-attach":"chat_chat-input-panel-inner-attach__mZheu","chat-input":"chat_chat-input__PQ_oF","chat-input-send":"chat_chat-input-send__GFQZo","toast-container":"chat_toast-container__rPoY4",show:"chat_show__7n05t","toast-content":"chat_toast-content__TpUJj"}},76173:function(e){e.exports={"message-exporter-body":"exporter_message-exporter-body__ieezO","export-content":"exporter_export-content__bLZvx",steps:"exporter_steps__6n3hv","steps-progress":"exporter_steps-progress__BaZCB","steps-progress-inner":"exporter_steps-progress-inner__Bx3Y4","steps-inner":"exporter_steps-inner__EVqvK",step:"exporter_step__WhCEO","step-finished":"exporter_step-finished__eBg9d","step-current":"exporter_step-current__oh5Mc","step-index":"exporter_step-index__bWRYR","step-name":"exporter_step-name__aj81m","preview-actions":"exporter_preview-actions__EdSLJ","image-previewer":"exporter_image-previewer__uKfNQ","preview-body":"exporter_preview-body__qK5Zf","chat-info":"exporter_chat-info__N_j5m",icons:"exporter_icons__7WRoV",logo:"exporter_logo__zu13e","main-title":"exporter_main-title__jjxAd","sub-title":"exporter_sub-title__p1RCl","icon-space":"exporter_icon-space__u_tMK","chat-info-item":"exporter_chat-info-item__3D12j",message:"exporter_message__3aahS",avatar:"exporter_avatar__fGOtt",user_avatar:"exporter_user_avatar__fJzLv",body:"exporter_body__gcKIl","message-image":"exporter_message-image__ofOeC","message-images":"exporter_message-images__oJoIX","message-image-multi":"exporter_message-image-multi__jzQdX","message-assistant":"exporter_message-assistant__sDmHi","message-user":"exporter_message-user__2t254"}},7e3:function(e){e.exports={"message-selector":"message-selector_message-selector__dOKbo","message-filter":"message-selector_message-filter__Q5XSd","search-bar":"message-selector_search-bar__4E5gq",actions:"message-selector_actions__MyZCT",messages:"message-selector_messages__GbOLr",message:"message-selector_message___TaV9","message-selected":"message-selector_message-selected__b3mDv",avatar:"message-selector_avatar__HCJ8t",body:"message-selector_body__rKEIZ",date:"message-selector_date__vc48w",content:"message-selector_content__Z9W8L",checkbox:"message-selector_checkbox__erPyd"}}}]);